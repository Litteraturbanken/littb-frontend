<meta-desc>
    {{workinfo.showtitle}} av {{authorById[author].fullname}}, sida {{pagename}} som {{mediatype}}
</meta-desc>
<breadcrumb>
    <a href="/#!/forfattare">författare</a>
    <a href="/#!/forfattare/{{author}}">{{authorById[author].surname}}</a>
    <a href="/#!/forfattare/{{author}}/titlar/{{workinfo.titlepath.split('/')[0]}}/info">{{workinfo.shorttitle || workinfo.showtitle}} s. {{pagename}} {{mediatype || ''}}</a>
</breadcrumb>
<img class="no-gradient" bkg-img src="img/las_bkg.jpg"></img>
<div class="reader_main" 
     ng-class="{'state-parallel' : isParallel, 'state-not-parallel' : !isParallel, searching:loading, editor: isEditor, focus : isFocus, 'type-faksimil' : mediatype == 'faksimil', 'ocr' : isOcr()}" ng-click="showFocusBar = !showFocusBar" ng-style="getTransform()">

    <div class="preloader">Hämtar sida <span class="dots_blink"></span></div>
    <div class="" ng-if="error">Ett fel inträffade vid sidhämtningen. </div>
    <div css="{{workinfo.css}}" if="mediatype == 'etext' || isParallel"></div>
    <div class="etext txt"
         selection-sniffer ng-show="mediatype == 'etext' || isParallel" ng-bind-html="etext_html | setMarkee:markee_from:markee_to | trust" ></div>
    
         <!-- ng-style="{height : overlayHeight, width : overlayWidth}" 

          -->
     <div selection-sniffer class="overlay" ng-if="mediatype == 'faksimil' && overlaydata.length">
         <div ng-repeat="list in overlaydata" >
             <!-- <div class="parent" ng-style="getOverlayCss(obj)" ng-repeat="obj in list">
                 <span class="w" big-text-alt="obj"  ></span>
             </div> -->
             <span big-text="obj" fac="overlayFactors[size - 1]" class="w parent" ng-repeat="obj in list" ng-style="getOverlayCss(obj)"> </span>

         </div>
     </div>

         <!-- <span class="word" ng-repeat="obj in list" ng-style="getOverlayCss(obj)" big-text="obj.word"></span> -->
         <!-- <span big-text class="word" ng-repeat="obj in list" ng-style="getOverlayCss(obj)">{{obj.word}} </span> -->
     
     <!-- <div ng-repeat="obj in overlaydata" big-text="obj.word" ng-style="getOverlayCss(obj)" ng-mousedown="overlayMousedown()" ng-mouseup="overlayMouseup()"></div> -->
     <!-- <span ng-repeat="obj in overlaydata" ng-style="getOverlayCss(obj)">{{obj.word}}</span> -->

    <img class="faksimil" ng-src="{{url}}" ng-show="mediatype == 'faksimil' || isParallel">

    <div square ng-repeat="obj in coors" ng-show="height" x="obj.x" 
         y="obj.y" w="obj.width" h="obj.height" 
         class="faksimilMarkee" ng-class="{long : obj.width > 150}"></div>
    
    
    <div toolkit toolkit-id="toolkit-right">
        <!-- <div id="ord-och-sak" ng-show="ordOchSakPage">
            <div ng-repeat="entry in ordOchSakPage" ng-mouseenter="markOosEntry(entry)" 
                 ng-mouseleave="unmarkOosEntries()">
                <span class="oos-ord">{{entry.ord}}</span><br>
                <span class="oos-forklaring">{{entry.forklaring}}</span>
            </div>
        </div> -->

        
        <div>
            <div class="author" ng-bind-html="getValidAuthors() | formatAuthors:authorById:true | trust"></div>
            <a class="title" 
                href="/#!/forfattare/{{author || getValidAuthors()[0].id}}/titlar/{{workinfo.titlepathNorm}}/info">
                {{workinfo.showtitle}}
            </a>
            <span tooltip="Tryckår" ng-show="workinfo.imprintyear">({{workinfo.imprintyear}})</span>
        </div>
        
        <!-- <div class="arrows">
            <div class="up fa fa-play"></div>
            <br>
            <div class="down fa fa-play"></div>
        </div> -->

        <hr>
        <div class="current_part">
            <div class="header">
                <a ng-click="show_chapters = true" ng-show="getCurrentPart().showtitle">Avsnitt eller del</a>
            </div>
            <!-- <h5 class="chapt_header sc">Kapitel</h5> -->
            <div ng-bind="getCurrentPart().showtitle" data-ellipsis tooltip="{{getCurrentPart().navtitle}}" class="navtitle"></div>
        </div>
        <hr class="lower">
        <!-- <ul class="part_menu" >
            <li><a ng-click="onPartClick(startpage)">[Start]</a></li>
            <li ng-repeat="part in workinfo.parts | limitTo:6" tooltip="{{part.showtitle}}">
                
                <a ng-touch="onPartClick(part.startpagename)" ng-click="onPartClick(part.startpagename)">{{part.navtitle}}</a>
            </li>
        </ul> -->

        <div class="pager_ctrls" ng-click="resetHitMarkings()">
            
            <a ng-href="{{getPageUrl(getPrevPart().startpagename)}}" ng-class="{disabled : !getPrevPart().startpagename}">Gå bakåt ett kapitel</a>
            <br>
            <a ng-href="{{getPageUrl(getNextPart().startpagename)}}">Gå till nästa kapitel</a>
            <br>
            <a ng-href="{{getFirstPageUrl()}}" ng-class="{disabled : isBeforeStartpage()}"
                ng-click="gotopage(startpage, $event)">
                Gå till första sidan
            </a>
            <br>
            <a ng-href="{{getLastPageUrl()}}" ng-class="{disabled : pagename == endpage}"
                ng-click="gotopage(endpage, $event)">
                Gå till sista sidan
            </a>
            <br>
            <form class="goto" ng-submit="gotopage(gotoInput)" >
                <a ng-click="onGotoClick()">Gå till sida . . . <span class="pages">{{pagename}} av {{endpage}}</span></a> <input focusable type="text" ng-show="showGotoInput" ng-model="gotoInput"> <i ng-show="showGotoInput" class="fa fa-angle-double-right"></i>
            </form>
            

            <a class="" rel="prev" ng-class="{disabled : pageix == 0}" ng-href="{{getPrevPageUrl()}}" ng-click="prevPage($event)">
                
                <button class="submit btn navicon" ng-click="$close()">
                    <i class="fa fa-angle-left "></i></button>
            </a>
            <a class="" rel="next" ng-href="{{getNextPageUrl()}}" ng-click="nextPage($event)" ng-class="{disabled : pagename == endpage}">
                <button class="submit btn navicon" ng-click="$close()">
                    <i class="fa fa-angle-right right"></i>
                </button>
            </a>

            <span class="expl small">Du kan också bläddra med tangentbordets piltangenter.</span>
        </div>
        
        
        <div class="subnav">
            <ul>
                <li ng-show="workinfo.parts.length"><a ng-click="show_chapters = true">Innehållsförteckning</a></li>
                <li><a ng-click="openModal()">Mer om boken</a></li>
                <li><a ng-click="activateFocus()">Läsfokus</a></li>
                <!-- <li>Visa som bokuppslag</li> -->
                <li>
                    <a popper="searchPopup" my="middle top+10" at="bottom middle">Sök i verket</a> 

                    <div class="searchbox popper_menu" ng-click="$event.stopPropagation()">
                        <div class="header">
                            Sök i <span class="author" ng-bind-html="getValidAuthors() | formatAuthors:authorById:true | trust"></span>
                            <div class="title">{{workinfo.title}}</div>
                        </div>



                        <div class="ctrls">
                            <form ng-submit="searchWork(search_query)">
                                <input autofocus type="text" ng-model="search_query">
                            </form>

                            <ul class="opts">
                                <li>Del av ord</li>
                                <li>Exakt stavning</li>
                                <li>Avancerad sökning</li>
                                
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a ng-href="/#!/sok?avancerad&forfattare={{author || getValidAuthors()[0].id}}">Sök i författarens texter</a></li>
                <li>Dela boken</li>
            </ul>
        </div>

        
    </div>
        <script type="text/ng-template" id="about.html">
            <div class="about-modal modal-body">
                <button class="close_btn submit btn pull-right" ng-click="$close()">Stäng</button>
                <ng-include src="'views/sourceInfo.html'"></ng-include>
            </div>
             
        </script>
        <script type="text/ng-template" id="chapters.html">
            <div class="chapters-modal modal-body">
            <button class="close_btn submit btn pull-right" ng-click="$close()">Stäng</button>

                <div class="header">
                    <h2 class="author sc" ng-bind-html="getValidAuthors() | formatAuthors:authorById:true | trust"></h2>
                    <h2 class="title" 
                        href="/#!/forfattare/{{author || getValidAuthors()[0].id}}/titlar/{{workinfo.titlepathNorm}}/info">
                        {{workinfo.showtitle}} <span tooltip="Tryckår" ng-show="workinfo.imprintyear">({{workinfo.imprintyear}})</span>
                     </h2>
                </div>

                <ul class="part_menu" >
                    <li ng-repeat="part in workinfo.parts" tooltip="{{part.showtitle}}">
                        <a ng-touch="onPartClick(part.startpagename)" ng-click="onPartClick(part.startpagename)">{{part.showtitle}}</a>
                    </li>
                </ul>
            </div>

        </script>

        <div toolkit>
            <div id="search_nav" ng-show="searchData.total_hits && (x || markee_from)">
                <div class="text">
                    <div>
                        <span class="num">{{searchData.total_hits}}</span> Sökträffar
                    </div>
                    <div>
                        Träff <span>{{searchData.current + 1}}</span>, sida {{page}}
                    </div>
                </div>
                <div class="ctrls">
                    <img ng-click="close_hits()" class="close_btn" src="/bilder/kryssruta.png">
                    <div style="clear:both;"></div>
                    <div class="arrows">
                        <i class="fa fa-angle-left" ng-click="prevHit()"></i>
                        <i class="fa fa-angle-right" ng-click="nextHit()"></i>
                        <!-- <img ng-click="prevHit()" class="" src="/bilder/v_pil.png"> 
                         -->
                         <!-- <img ng-click="nextHit()" class="" src="/bilder/h_pil.png"> -->
                    </div>
                </div>
            </div>
            
        </div>
    <!-- <div toolkit>
        <div ng-class="{editor: isEditor}">
            <hr>
            
        
            
        
            <div style="height: 1em;"></div>
        
            <div><a href="/#!/forfattare/{{author || getValidAuthors()[0].id}}/titlar/{{workinfo.titlepathNorm || title}}/info">::: Om boken</a></div>
        
            <hr>
        
        
            
            <form ng-submit="pageToLoad = displaynum">
                <span ng-if="isEditor">Index</span> 
                <span ng-if="!isEditor">Sida</span> 
                <input class="pageinput" ng-model="displaynum">
            </form>
        
            <div ng-if="!isEditor">
                <ul class="work_parts">
                    <li><a ng-click="gotopage(startpage)">[Start]</a></li>
                    <li ng-repeat="part in workinfo.parts | limitTo:5" 
                        tooltip="{{getTooltip(part)}}" tooltip-append-to-body>
                        <a ng-click="gotopage(part.startpagename)">{{part.navtitle}}</a>
                    </li>
                </ul>
            </div>
        
            <div class="partnav" ng-show="workinfo.parts.length > 5">
                <div>
                    <i ng-mouseover="mouseover()" 
                        ng-touch="mouseover()"
                        class="arrow_icon fa fa-play"></i>
                </div>
        
                <div ng-show="showPopup" class="triangle"></div>
        
        
            </div>
        
            <div class="size_picker" ng-show="mediatype == 'faksimil'">
                <div ng-class="{selected : size, hidden : !isDefined(size)}" 
                     ng-repeat="size in sizes track by $index" ng-click="setSize($index)">{{$index}}</div>
                
            </div>
    
            <div ng-if="supportsParallel()"><a ng-click="toggleParallel()">
                <span ng-if="!isParallel">
                    Visa <span ng-show="mediatype == 'etext'">faksimil</span> 
                    <span ng-show="mediatype == 'faksimil'">etext</span> 
                    parallellt</span>
                <span ng-if="isParallel">Stäng parallellvisningen</span>
            </a></div>

            <div class="focusBtn">
                <a ng-click="activateFocus()">Fokusläge</a>
            </div>
        
        
            
        </div>
    </div> -->
    <div ng-show="isFocus" class="leftCover" ng-click="prevPage($event)" to-body></div>
    <div ng-show="isFocus" class="rightCover" ng-click="nextPage($event)" to-body></div>
    <div ng-show="isFocus && showFocusBar" class="bottomBar" set-class="{'ng-hide-remove' : !isFocus}" to-body>
        
        <a popper my="middle bottom-25" at="bottom middle" >
            <span class="letters">a A</span>
            <!-- <span ng-include="'img/focus_letters.svg'" class="sizeBtn"> -->
        </a>
        <div class="popper_menu popover top text" ng-class="{'type-faksimil' : mediatype == 'faksimil'}">
            <div class="arrow"></div>
            <div class="popover_inner">

                <ul ng-show="mediatype == 'etext'">
                    <li><button ng-click="incrFontSize($event, -0.1)" class="small_text btn btn-small">Mindre <br> text</button> 
                    <button ng-click="incrFontSize($event, 0.1)" class="btn btn-small pull-right">Större <br> text</button></li>
                </ul>
                <div class="size_picker" ng-show="mediatype == 'faksimil'">
                    <div ng-class="{selected : size, hidden : !isDefined(size)}" 
                         ng-repeat="size in sizes track by $index" ng-click="setSize($index)">{{$index}}</div>
                    
                </div>
                <div class="night_switch on" ng-if="mediatype!= 'faksimil' && !$root._night_mode" ng-click="$root._night_mode = true"><span class="icon"></span> <div class="label">Nattläge</div></div>
                <div class="night_switch off" ng-if="mediatype!= 'faksimil' && $root._night_mode" ng-click="$root._night_mode = false"><span class="icon"></span> <div class="label">Ljust läge</div></div>
            </div>
        </div>


        <a class="nav left" rel="prev" ng-class="{disabled : pageix == 0}" ng-href="{{getPrevPageUrl()}}" ng-click="prevPage($event)">
            <i class="fa fa-angle-left "></i>
        </a>
        <a class="nav right" rel="next" ng-href="{{getNextPageUrl()}}" ng-click="nextPage($event)" ng-class="{disabled : pagename == endpage}">
            <i class="fa fa-angle-right"></i>
            <!-- <i class="fa fa-forward"></i> -->
        </a>

        <a popper my="middle bottom-25" at="bottom middle" >
            <i class="fa fa-list-ul"></i>
        </a>

        <div class="popper_menu popover top parts">
            <div class="arrow"></div>
            <div class="popover_inner">
                <ul class="work_parts">
                    <li><a ng-click="gotopage(startpage)">[Start]</a></li>
                    <li ng-repeat="part in workinfo.parts">
                        <a ng-click="gotopage(part.startpagename)">{{part.navtitle}}</a>
                    </li>
                </ul>
            </div>
        </div>
        <a ng-click="closeFocus($event)">
            <i class="close_btn fa fa-times"></i>
        </a>
    </div>

    <!-- -->
</div>